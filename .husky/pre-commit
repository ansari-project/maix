echo "üîç Running pre-commit checks..."

# Step 1: Build check
echo "üì¶ Running build check..."
npm run build
if [ $? -ne 0 ]; then
  echo "‚ùå Build failed. Please fix build errors before committing."
  exit 1
fi

# Step 2: Unit tests
echo "üß™ Running unit tests..."
npm run test -- --silent
if [ $? -ne 0 ]; then
  echo "‚ùå Unit tests failed. Please fix failing tests before committing."
  exit 1
fi

# Step 3: E2E tests (optional - can be skipped with SKIP_E2E=1)
if [ "$SKIP_E2E" != "1" ]; then
  echo "üé≠ Running E2E tests..."
  # Check if dev server is running
  curl -s http://localhost:3000 > /dev/null 2>&1
  if [ $? -ne 0 ]; then
    echo "‚ö†Ô∏è  Dev server not running at http://localhost:3000"
    echo "   Skipping E2E tests. Run 'npm run dev' in another terminal to enable E2E testing."
  else
    npm run test:e2e
    if [ $? -ne 0 ]; then
      echo "‚ùå E2E tests failed. Please fix failing tests before committing."
      echo "   You can skip E2E tests with: SKIP_E2E=1 git commit ..."
      exit 1
    fi
  fi
else
  echo "‚è≠Ô∏è  Skipping E2E tests (SKIP_E2E=1)"
fi

echo "‚úÖ All pre-commit checks passed!"