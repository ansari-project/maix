echo "üîç Running pre-commit checks..."

# Step 1: Build check
echo "üì¶ Running build check..."
npm run build
if [ $? -ne 0 ]; then
  echo "‚ùå Build failed. Please fix build errors before committing."
  exit 1
fi

# Step 2: Unit tests
echo "üß™ Running unit tests..."
npm run test -- --silent
if [ $? -ne 0 ]; then
  echo "‚ùå Unit tests failed. Please fix failing tests before committing."
  exit 1
fi

# Step 3: E2E tests (disabled by default - enable with RUN_E2E=1)
if [ "$RUN_E2E" = "1" ]; then
  echo "üé≠ Running E2E tests..."
  # Check if dev server is running
  curl -s http://localhost:3000 > /dev/null 2>&1
  if [ $? -ne 0 ]; then
    echo "‚ö†Ô∏è  Dev server not running at http://localhost:3000"
    echo "   Please run 'npm run dev' in another terminal before committing with E2E tests."
    exit 1
  else
    npm run test:e2e
    if [ $? -ne 0 ]; then
      echo "‚ùå E2E tests failed. Please fix failing tests before committing."
      exit 1
    fi
  fi
else
  echo "‚è≠Ô∏è  Skipping E2E tests (set RUN_E2E=1 to enable)"
fi

echo "‚úÖ All pre-commit checks passed!"